# –û—Ç—á—ë—Ç –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è - Mentorium Chat Bot

**–î–∞—Ç–∞**: 11 –º–∞—Ä—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã ‚úÖ

#### Redis
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `redis-server` –≤–µ—Ä—Å–∏–∏ 7.0.15
- –ó–∞–ø—É—â–µ–Ω –∫–∞–∫ systemd —Å–µ—Ä–≤–∏—Å
- –ü—Ä–æ–≤–µ—Ä–∫–∞: `redis-cli ping` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `PONG`

#### PostgreSQL
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PostgreSQL 16
- –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `mentorium` —Å –ø–∞—Ä–æ–ª–µ–º `mentorium_dev_pass`
- –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `mentorium_bot` —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º `mentorium`
- –ù–∞–∑–Ω–∞—á–µ–Ω—ã –≤—Å–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ –ë–î

#### Poetry
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Poetry 2.2.1 –≤ `~/.local/bin/poetry`
- –î–æ–±–∞–≤–ª–µ–Ω –≤ PATH –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚úÖ

–ß–µ—Ä–µ–∑ Poetry —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–∞–∫–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞:
- **–û—Å–Ω–æ–≤–Ω—ã–µ**: aiogram 3.22.0, fastapi 0.110.3, sqlalchemy 2.0.44
- **–ë–î**: asyncpg 0.29.0, psycopg 3.2.12, alembic 1.17.1
- **AI**: openai 1.109.1
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: redis 5.3.1, celery 5.5.3, apscheduler 3.11.1
- **Dev tools**: pytest, mypy, ruff, black, pre-commit

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚úÖ

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª—ë–Ω `packages/db/mentorium_db/settings.py`:
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è `.env`
  - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`BOT_DB_URL`, `PLATFORM_DB_URL`)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–≤–æ–π—Å—Ç–≤–∞ `url`, `async_url`, `platform_async_url`
  
#### Alembic
- –û–±–Ω–æ–≤–ª—ë–Ω `alembic.ini` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º connection string
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–∞ `alembic/script.py.mako`
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `1312f8e110a8_initial_schema.py`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã
  - `learners` - –¥–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–æ–≤
  - `parent_chats` - Telegram —á–∞—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π
  - `progress_reports` - –æ—Ç—á—ë—Ç—ã –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
  - `subscription_invoices` - —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.env` –∏–∑ `.env.example` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```bash
BOT_TELEGRAM_TOKEN=8251494920:AAE0O2XmqTX3te9OKDtrl3-5M8sO8ti4E5E
BOT_OPENAI_API_KEY=sk-proj-V3zy...X_MA
REPORT_OPENAI_API_KEY=sk-proj-V3zy...X_MA
BOT_DB_URL=postgresql+asyncpg://mentorium:mentorium_dev_pass@localhost:5432/mentorium_bot
REDIS_URL=redis://localhost:6379/0
SENTRY_DSN=https://559034b3...
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ

#### –°–∫—Ä–∏–ø—Ç `scripts/verify_setup.py`
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
- ‚úÖ –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å OpenAI API –∫–ª—é—á–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π `README.md` —Å:
- –û–ø–∏—Å–∞–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø—Ä–æ–µ–∫—Ç–∞
- –ì–∞–π–¥–∞–º–∏ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- Roadmap –Ω–∞ 4 —Ñ–∞–∑—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Mentorium-Chat-Bot/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot/mentorium_bot/   # Telegram –±–æ—Ç (aiogram)
‚îÇ   ‚îú‚îÄ‚îÄ reporting_worker/             # Worker –æ—Ç—á—ë—Ç–æ–≤ (APScheduler)
‚îÇ   ‚îî‚îÄ‚îÄ billing_service/              # API –ø–ª–∞—Ç–µ–∂–µ–π (FastAPI)
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ ai_client/                    # OpenAI –æ–±—ë—Ä—Ç–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ core/                         # –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ db/                           # SQLAlchemy + Alembic
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ verify_setup.py               # ‚ú® –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ .env                              # ‚ú® –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ pyproject.toml                    # Poetry –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md                         # ‚ú® –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å—Ö–µ–º–æ–π
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- Poetry –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### ‚úÖ –ö–æ–¥
- SQLAlchemy –º–æ–¥–µ–ª–∏ (Learner, ParentChat, ProgressReport, SubscriptionInvoice)
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞ (handlers, config, dependencies)
- AI client –¥–ª—è OpenAI
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ (reporting_worker, billing_service)

### ‚úÖ DevOps
- Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- CI/CD pipeline (.github/workflows/ci.yml)
- Pre-commit hooks (.pre-commit-config.yaml)
- Sentry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å):

1. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞**
   ```bash
   poetry run python -m mentorium_bot
   ```

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è handlers**
   - `/start` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
   - `/report` - –∑–∞–ø—Ä–æ—Å –æ—Ç—á—ë—Ç–∞
   - AI-–¥–∏–∞–ª–æ–≥ —Å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Platform DB**
   - –ü–æ–ª—É—á–∏—Ç—å credentials –¥–ª—è read-only –¥–æ—Å—Ç—É–ø–∞
   - –û–±–Ω–æ–≤–∏—Ç—å `PLATFORM_DB_URL` –≤ `.env`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```bash
   poetry run pytest tests/
   ```

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏):

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π**
   - FSM –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ flow
   - –í–∞–ª–∏–¥–∞—Ü–∏—è email
   - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —É—á–µ–Ω–∏–∫–∞–º

2. **AI –¥–∏–∞–ª–æ–≥–∏**
   - –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≤ Redis
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è —É—á–µ–Ω–∏–∫–∞
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –¥–∏–∞–ª–æ–≥–∞

3. **–û—Ç—á—ë—Ç—ã**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ OpenAI
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram
   - –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1 –º–µ—Å—è—Ü):

1. **–ü–ª–∞—Ç–µ–∂–∏**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Ä—á–∞–Ω—Ç–æ–≤ Payme/Click
   - Webhook endpoints
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

2. **Admin –ø–∞–Ω–µ–ª—å**
   - FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–æ—Ç–∞–º
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - Sentry alerts
   - –ú–µ—Ç—Ä–∏–∫–∏ Redis
   - –õ–æ–≥–∏ –≤ structured format

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**PostgreSQL**:
```python
from mentorium_db.session import get_session

async with get_session() as session:
    # –í–∞—à –∫–æ–¥
```

**Redis**:
```python
import redis
r = redis.Redis(host='localhost', port=6379, db=0)
r.set('key', 'value')
```

**OpenAI**:
```python
from mentorium_ai_client import MentorAIClient

client = MentorAIClient(api_key=settings.openai_key)
reply = await client.generate_reply(prompt, history)
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd packages/db

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
poetry run alembic revision --autogenerate -m "Add column"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å
poetry run alembic upgrade head

# –û—Ç–∫–∞—Ç
poetry run alembic downgrade -1
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í –ª—é–±–æ–µ –≤—Ä–µ–º—è –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
poetry run python scripts/verify_setup.py
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
poetry shell

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
poetry run python -m mentorium_bot

# –¢–µ—Å—Ç—ã
poetry run pytest

# –õ–∏–Ω—Ç–µ—Ä—ã
poetry run ruff check .
poetry run black .
poetry run mypy .

# –ú–∏–≥—Ä–∞—Ü–∏–∏
cd packages/db && poetry run alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
poetry run python scripts/verify_setup.py
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üéâ

–í—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, Python –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Poetry, –∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

–ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞.

---

**–ê–≤—Ç–æ—Ä**: GitHub Copilot  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã  
**–°—Ç–∞—Ç—É—Å**: Ready for development üöÄ